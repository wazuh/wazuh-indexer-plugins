# Setup
For long, Wazuh has delegated the creation of indices to Filebeat. [The wazuh-template.json](https://github.com/wazuh/wazuh/blob/main/extensions/elasticsearch/7.x/wazuh-template.json), the index template for the alerts generated by Wazuh, was given to Filebeat, which together with the [pipelines](https://github.com/wazuh/wazuh/blob/main/extensions/filebeat/7.x/filebeat.yml) was tasked with the creation of daily indices following the settings, mappings and types given by the template.

As [Elastic changed its code license](https://www.elastic.co/blog/why-license-change-aws/), Wazuh moved to OpenSearch, which then was forked and became Wazuh Indexer. The version of Filebeat had to be frozen at 7.10.2, which is the latest version compatible with OpenSearch. This version is quite a few years old now and contains several important vulnerabilities. Aside from that, the Index Life Management features are not compatible with OpenSearch Index State Management module, greatly limiting our ability to manage our indices in a feasible manner. 

Due to these and more reasons, a project came on the table to redesign the way we manage our indices, being the wazuh-indexer the responsible component of their creation and management. The main goal is to bind the creation of the required index templates, the indices and the ISM policies to the initialization / installation process of the Indexer.

As a [first approach](https://github.com/wazuh/internal-devel-requests/issues/600), this project was faced as an initialization script in bash, similar to the security-admin.sh, which would wait for the Indexer API to be ready, and then create all the stuff via HTTP requests. Although functional, this approach was discarded as external entities could create indices before the script, breaking the installation. Filebeat was the main external entity in this case, having admin permissions and hence able to create indices on his own, casing the initialization script to fail as the indices had already been created by Filebeat (race condition). Changing the permissions of Filebeat was considered a breaking change in 4.x, so the project was delayed to the next major version.

For 5.x however, having moved to the fork version of Wazuh Indexer and having full ownership of the component, it was decided to move the initialization to a plugin. The Wazuh Indexer Setup Plugin in responsible for:
- Create the index templates.
- Create the initial indices.
- Create the indices aliases and ISM policies where needed.
- Ensure Users and Roles are created for other Wazuh components to use (RBAC).
