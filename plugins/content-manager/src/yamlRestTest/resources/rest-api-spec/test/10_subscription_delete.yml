---
"Test subscription DELETE returns 404 when no subscription exists":
  - skip:
      features: headers
  - do:
      catch: missing
      content_manager_subscription_delete: {}

  - match: { status: 404 }
  - match: { message: "Subscription not found" }

---
"Test subscription DELETE returns 200 when subscription exists":
  - skip:
      features: headers
  - do:
      headers:
        Content-Type: application/json
      content_manager_subscription_post:
        body: |
          {
            "device_code": "test-device-code",
            "client_id": "test-client-id",
            "expires_in": 3600,
            "interval": 5
          }

  - match: { status: 201 }

  - do:
      content_manager_subscription_delete: {}

  - match: { status: 200 }
  - match: { message: "Subscription deleted successfully" }

---
"Test subscription DELETE is idempotent (second delete returns 404)":
  - skip:
      features: headers
  - do:
      headers:
        Content-Type: application/json
      content_manager_subscription_post:
        body: |
          {
            "device_code": "test-device-code",
            "client_id": "test-client-id",
            "expires_in": 3600,
            "interval": 5
          }

  - match: { status: 201 }

  - do:
      content_manager_subscription_delete: {}

  - match: { status: 200 }
  - match: { message: "Subscription deleted successfully" }

  # Second delete should return 404
  - do:
      catch: missing
      content_manager_subscription_delete: {}

  - match: { status: 404 }
  - match: { message: "Subscription not found" }
